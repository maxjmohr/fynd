{% extends "base.html" %}

{% block title %}
Discover destinations
{% endblock %}

{% block main %}

<div class="discover-form-container">
    <div class="discover-form-introtext">
        <p>For some of our dimension scores we need some information from you. In addition, we use this input to compute the relevance of the various destinations based on your characteristics. <a href="/about">Learn more.</a> </p>
    </div>
    <form method="post">
        {% csrf_token %}
        <div class="form-group question-box">
            <label for="{{ form.start_location.id_for_label }}">{{ form.start_location.help_text }}</label>
            {{ form.start_location.errors }}
            {{ form.start_location.as_widget }}
            {{ form.start_location_lat.as_widget }}
            {{ form.start_location_lon.as_widget }}
        </div>
        <div class="form-group question-box">
            <label for="{{ form.date_range.id_for_label }}">{{ form.date_range.help_text }}</label>
            {{ form.date_range.errors }}
            {{ form.date_range.as_widget }}
        </div>
        <div class="form-group question-box">
            <label for="{{ form.previous_locations.id_for_label }}">{{ form.previous_locations.help_text }}</label>
            {{ form.previous_locations.errors }}
            {{ form.previous_locations.as_widget }}
        </div>
        <input type="submit" value="Go" class="submit-button">
    </form>
</div>

{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#id_start_location').autocomplete({
        source: function(request, response) {
            $.get('https://nominatim.openstreetmap.org/search', {
                q: request.term,
                format: 'json'
            }, function(data) {
                response($.map(data, function(item) {
                    return {
                        label: item.display_name,
                        value: item.display_name,
                        lat: item.lat,
                        lon: item.lon
                    };
                }));
            });
        },
        select: function(event, ui) {
            $('#id_start_location_lat').val(ui.item.lat);
            $('#id_start_location_lon').val(ui.item.lon);
        },
        minLength: 2
    });
});
</script>
{% endblock %}